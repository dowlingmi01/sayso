#!/bin/bash

green()
{
echo -e "\n\e[32m$1\e[39;49m"
}
red()
{
echo -e "\n\e[31m$1\e[39;49m"
}

red "SAYSO automatic updater running..."
echo ""


OWNDIR=`pwd`
SVN=`which svn`

echo ""
green "Creating maintainance lock file..."
echo ""

touch ../public/.maintainance

echo ""
green "Cleaning cache..."
echo ""

rm -rfv ../cache/*

cd ../../library
IN=`pwd`
echo ""
green "Updating library in \"$IN\"..."
echo ""

$SVN up

cd "$OWNDIR"
cd ..
IN=`pwd`
echo ""
green "Updating application in \"$IN\"..."
echo ""

$SVN up

echo ""
green "Launching database update..."
echo ""

cd "$OWNDIR"
./sayso incremental

echo ""
green "Removing maintainance lock file..."
echo ""

rm -fv ../public/.maintainance

echo ""
red "All done"
echo ""
